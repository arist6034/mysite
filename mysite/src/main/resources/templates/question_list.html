<html layout:decorate="~{layout}">
	
	<div class="container" layout:fragment="content">
		<h1>질문 목록</h1>
		<div class="row">
			<div class="col">
				<div class="p-5 text-center bg-body-tertiary rounded-3">
					<h1>질문 목록</h1>
				</div>
				<a th:href="@{/question/create}" class="btn btn-primary">질문 등록하기</a>
				<div class="input-group">
					<input type="text" id="search_kw" class="form-control" th:value="${kw}"/>
					<button class="btn btn-outline-secondary" type="button" id="btn_search">검색</button>
				</div>
				<form th:action="@{/question/list}" method="get" id="searchForm">
					<input type="text" id="kw" th:value="${kw}" name="kw" hidden/>
					<input type="text" id="page" th:value="${questionList.number}"  name="page" hidden/>
				</form>
				<table class="table">
				  <thead>
					<tr>
						<th>번호</th>
						<th>제목</th>
						<th>글쓴이</th>
						<th>작성날짜</th>
					</tr>
				  </thead>
				  <tbody>
					<tr th:each="question, loop : ${questionList}">
						<td th:text="${questionList.getTotalElements - (questionList.number * questionList.size)- loop.index}"></td>
						<td>
							<a th:href="@{|/question/detail/${question.id}|}" th:text="${question.subject}"></a>
							<spen class="text-danger badge bg-warning" th:if="${#lists.size(question.answerList) > 0}" th:text="${#lists.size(question.answerList)}">댓글</spen>
						</td>
						<td th:text="${question.author?.username}"></td>
						<td th:text="${#temporals.format(question.createDate)}" th:href></td>
					</tr>
				</table>
			</div>
		</div>
		<table>
			<!-- 페이징 처리 시작 -->
			<div class="row">
			<div class="col d-flex w-100">
			<nav aria-label="Page navigation example" th:if="${!questionList.isEmpty}" class="w-100" >
			<ul class="pagination justify-content-center">
			  <li class="page-item" th:classappend="${!questionList.hasPrevious} ? 'disabled'"><a class="page-link" th:data-page="${questionList.number-1}" href="javascript:void(0)">이전</a></li>
			  <li class="page-item" th:each="page : ${#numbers.sequence(0, questionList.totalPages-1)}" th:classappend="${questionList.number == page} ? 'active'" th:if="${page >= questionList.number-5 and page <= questionList.number+5}"><a class="page-link" th:data-page="${page}" href="javascript:void(0)">[[${page+1}]]</a></li>
			  <li class="page-item" th:classappend="${!questionList.hasNext} ? 'disabled'"><a class="page-link" th:data-page="${questionList.number+1}" href="javascript:void(0)">다음</a></li>
			</ul>
			</nav>
			</div>
			</div>
		</table>
	</div>
	<script layout:fragment="script">
		const page_elements = document.getElementsByClassName("page-link");
		Array.from(page_elements).forEach(function(element){
			element.addEventListener("click", function(){
				document.getElementById("page").value=this.dataset.page;
				document.getElementById("searchForm").submit();
			})
		})
		
		
		const btn_search = document.getElementById("btn_search");
					btn_search.addEventListener("click", function(){
						console.log("작동됨");
						document.getElementById("kw").value = document.getElementById("search_kw").value;
						document.getElementById("page").value=0;
						document.getElementById("searchForm").submit();
					})
	</script>
	
</html>